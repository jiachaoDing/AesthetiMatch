# ğŸš€ éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²ç­–ç•¥æ¦‚è§ˆ

### éƒ¨ç½²æ¶æ„
```
å¼€å‘ç¯å¢ƒ:
â”œâ”€â”€ å‰ç«¯: æœ¬åœ° Vite å¼€å‘æœåŠ¡å™¨ (localhost:5173)
â”œâ”€â”€ åç«¯: æœ¬åœ° Express æœåŠ¡å™¨ (localhost:3001)
â””â”€â”€ æ•°æ®åº“: Supabase å¼€å‘é¡¹ç›®

ç”Ÿäº§ç¯å¢ƒ:
â”œâ”€â”€ å‰ç«¯: Vercel (é™æ€éƒ¨ç½² + CDN)
â”œâ”€â”€ åç«¯: Railway (å®¹å™¨åŒ–éƒ¨ç½²)
â””â”€â”€ æ•°æ®åº“: Supabase ç”Ÿäº§é¡¹ç›®
```

### ç¯å¢ƒå˜é‡ç®¡ç†
```bash
# å¼€å‘ç¯å¢ƒ (.env.local)
VITE_API_URL=http://localhost:3001
VITE_SUPABASE_URL=https://your-dev-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-dev-anon-key

# ç”Ÿäº§ç¯å¢ƒ (.env.production)
VITE_API_URL=https://your-backend.railway.app
VITE_SUPABASE_URL=https://your-prod-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-prod-anon-key
```

---

## ğŸŒ å‰ç«¯éƒ¨ç½² (Vercel)

### 1. å‡†å¤‡éƒ¨ç½²æ–‡ä»¶
```json
// frontend/package.json
{
  "scripts": {
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.4.0",
    "vite": "^4.4.5"
  }
}
```

### 2. Vercelé…ç½®
```json
// vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "frontend/package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "frontend/dist"
      }
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "https://your-backend.railway.app/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/frontend/$1"
    }
  ]
}
```

### 3. è‡ªåŠ¨éƒ¨ç½²é…ç½®
```yaml
# .github/workflows/frontend-deploy.yml
name: Deploy Frontend
on:
  push:
    branches: [ main ]
    paths: [ 'frontend/**' ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: |
        cd frontend
        npm ci
    
    - name: Build project
      run: |
        cd frontend
        npm run build
      env:
        VITE_API_URL: ${{ secrets.VITE_API_URL }}
        VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
        VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
    
    - name: Deploy to Vercel
      uses: vercel/action@v20.0.0
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
        working-directory: frontend
```

---

## ğŸ–¥ï¸ åç«¯éƒ¨ç½² (Railway)

### 1. å‡†å¤‡éƒ¨ç½²æ–‡ä»¶
```json
// backend/package.json
{
  "scripts": {
    "start": "node src/server.js",
    "dev": "nodemon src/server.js",
    "build": "echo 'No build step required'"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
```

### 2. Railwayé…ç½®
```yaml
# railway.json
{
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "cd backend && npm start",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 300
  }
}
```

### 3. ç¯å¢ƒå˜é‡è®¾ç½®
```bash
# Railwayç¯å¢ƒå˜é‡ (åœ¨Railwayä»ªè¡¨æ¿è®¾ç½®)
NODE_ENV=production
PORT=3001
FRONTEND_URL=https://your-frontend.vercel.app
SUPABASE_URL=https://your-prod-project.supabase.co
SUPABASE_SERVICE_KEY=your-prod-service-key
```

---

## ğŸ—„ï¸ æ•°æ®åº“éƒ¨ç½² (Supabase)

### 1. æ•°æ®åº“è¡¨ç»“æ„
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  nickname VARCHAR(100),
  avatar_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æµ‹è¯•ç»“æœè¡¨
CREATE TABLE test_results (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  answers JSONB NOT NULL,
  scores JSONB NOT NULL,
  aesthetic_type VARCHAR(50) NOT NULL,
  description TEXT,
  traits TEXT[],
  confidence DECIMAL(3,2),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æˆ¿é—´è¡¨
CREATE TABLE rooms (
  id VARCHAR(50) PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  description TEXT,
  creator_id UUID REFERENCES users(id),
  participants UUID[],
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  expires_at TIMESTAMP WITH TIME ZONE NOT NULL
);
```

### 2. è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)
```sql
-- å¯ç”¨RLS
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE test_results ENABLE ROW LEVEL SECURITY;
ALTER TABLE rooms ENABLE ROW LEVEL SECURITY;

-- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can view own data" ON users
  FOR SELECT USING (auth.uid() = id);

-- æµ‹è¯•ç»“æœç­–ç•¥
CREATE POLICY "Users can view own test results" ON test_results
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own test results" ON test_results
  FOR INSERT WITH CHECK (auth.uid() = user_id);
```

---

## ğŸ”„ CI/CDæµæ°´çº¿

### å®Œæ•´éƒ¨ç½²æµç¨‹
```yaml
# .github/workflows/deploy.yml
name: Deploy Application
on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: |
        npm ci
        cd frontend && npm ci
        cd ../backend && npm ci
    
    - name: Run tests
      run: |
        cd frontend && npm run test
        cd ../backend && npm test

  deploy-backend:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Deploy Backend
      run: |
        cd backend
        railway up
      env:
        RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

  deploy-frontend:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Build and Deploy Frontend
      uses: vercel/action@v20.0.0
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
        working-directory: frontend
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. é”™è¯¯ç›‘æ§ (Sentry)
```javascript
// frontend/src/main.js
import { createApp } from 'vue'
import * as Sentry from "@sentry/vue"

const app = createApp(App)

Sentry.init({
  app,
  dsn: import.meta.env.VITE_SENTRY_DSN,
  environment: import.meta.env.MODE,
  tracesSampleRate: 1.0,
})

app.mount('#app')
```

### 2. æ€§èƒ½ç›‘æ§
```javascript
// backend/src/middleware/metrics.js
const metrics = {
  requests: 0,
  responses: { success: 0, error: 0 },
  responseTime: []
}

const metricsMiddleware = (req, res, next) => {
  const start = Date.now()
  metrics.requests++
  
  res.on('finish', () => {
    const duration = Date.now() - start
    metrics.responseTime.push(duration)
    
    if (res.statusCode < 400) {
      metrics.responses.success++
    } else {
      metrics.responses.error++
    }
  })
  
  next()
}

// ç›‘æ§ç«¯ç‚¹
app.get('/metrics', (req, res) => {
  res.json({
    ...metrics,
    avgResponseTime: metrics.responseTime.reduce((a, b) => a + b, 0) / metrics.responseTime.length || 0
  })
})
```

---

## ğŸ”’ å®‰å…¨é…ç½®

### 1. HTTPSå’Œå®‰å…¨å¤´
```javascript
// backend/src/server.js
const helmet = require('helmet')

app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
      scriptSrc: ["'self'"]
    }
  }
}))
```

### 2. ç¯å¢ƒå˜é‡éªŒè¯
```javascript
// backend/src/config/env.js
const requiredEnvVars = [
  'SUPABASE_URL',
  'SUPABASE_SERVICE_KEY',
  'FRONTEND_URL'
]

requiredEnvVars.forEach(envVar => {
  if (!process.env[envVar]) {
    console.error(`âŒ Missing required environment variable: ${envVar}`)
    process.exit(1)
  }
})

console.log('âœ… All required environment variables are set')
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

#### 1. éƒ¨ç½²å¤±è´¥
```bash
# æ£€æŸ¥æ„å»ºæ—¥å¿—
vercel logs --follow

# æ£€æŸ¥Railwayéƒ¨ç½²çŠ¶æ€
railway status

# æœ¬åœ°æµ‹è¯•ç”Ÿäº§æ„å»º
cd frontend && npm run build && npm run preview
cd backend && NODE_ENV=production npm start
```

#### 2. APIè¿æ¥é—®é¢˜
```javascript
// å‰ç«¯APIè¿æ¥æ£€æŸ¥
const checkAPIConnection = async () => {
  try {
    const response = await fetch('/api/health')
    console.log('API Status:', response.status)
  } catch (error) {
    console.error('APIè¿æ¥å¤±è´¥:', error)
  }
}
```

#### 3. ç¯å¢ƒå˜é‡é—®é¢˜
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $VITE_API_URL
echo $SUPABASE_URL

# Railwayç¯å¢ƒå˜é‡
railway variables

# Vercelç¯å¢ƒå˜é‡
vercel env ls
```

è¿™ä¸ªéƒ¨ç½²æŒ‡å—æä¾›äº†å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆï¼Œç¡®ä¿é¡¹ç›®èƒ½å¤Ÿç¨³å®šè¿è¡Œå¹¶å…·å¤‡è‰¯å¥½çš„ç›‘æ§èƒ½åŠ›ã€‚ 